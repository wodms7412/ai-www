import streamlit as st
import pandas as pd
import random

# --- 🍚 재료 및 데이터 정의 (10가지) ---
# 실제 사용량 순위 데이터는 구하기 어려우므로, 비교를 위해 임의의 '상대적 사용량 점수'를 설정했습니다.
INGREDIENT_DATA = {
    "쌀": {
        "사용량_순위": {"중국": 100, "인도": 95, "인도네시아": 80, "방글라데시": 75, "베트남": 70, "태국": 65, "미얀마": 60, "필리핀": 55, "브라질": 50, "일본": 45},
        "유명_음식": ["볶음밥 (중국)", "비리야니 (인도)", "스시 (일본)"]
    },
    "밀": {
        "사용량_순위": {"중국": 100, "인도": 90, "러시아": 75, "미국": 70, "프랑스": 65, "캐나다": 60, "파키스탄": 55, "터키": 50, "독일": 45, "우크라이나": 40},
        "유명_음식": ["파스타 (이탈리아)", "난 (인도)", "바게트 (프랑스)"]
    },
    "닭고기": {
        "사용량_순위": {"미국": 100, "중국": 90, "브라질": 85, "러시아": 70, "멕시코": 65, "인도": 60, "아르헨티나": 55, "일본": 50, "영국": 45, "독일": 40},
        "유명_음식": ["프라이드치킨 (미국)", "치킨 티카 마살라 (인도/영국)", "야키토리 (일본)"]
    },
    "소고기": {
        "사용량_순위": {"미국": 100, "브라질": 95, "중국": 80, "아르헨티나": 75, "호주": 70, "러시아": 65, "멕시코": 60, "캐나다": 55, "프랑스": 50, "독일": 45},
        "유명_음식": ["스테이크 (미국)", "아사도 (아르헨티나)", "비프 부르기뇽 (프랑스)"]
    },
    "돼지고기": {
        "사용량_순위": {"중국": 100, "EU (독일/스페인)": 90, "미국": 85, "베트남": 75, "러시아": 70, "브라질": 65, "필리핀": 60, "일본": 55, "멕시코": 50, "한국": 45},
        "유명_음식": ["바비큐 포크 (미국)", "하몬 (스페인)", "삼겹살 (한국)"]
    },
    "감자": {
        "사용량_순위": {"벨라루스": 100, "폴란드": 90, "러시아": 85, "네덜란드": 80, "독일": 75, "페루": 70, "영국": 65, "미국": 60, "중국": 55, "인도": 50},
        "유명_음식": ["프렌치 프라이 (벨기에)", "매시트 포테이토 (영국)", "페루식 포테이토 스튜 (페루)"]
    },
    "토마토": {
        "사용량_순위": {"이탈리아": 100, "미국": 90, "스페인": 85, "터키": 80, "이집트": 75, "인도": 70, "중국": 65, "멕시코": 60, "브라질": 55, "그리스": 50},
        "유명_음식": ["피자 (이탈리아)", "가스파초 (스페인)", "토마토 수프 (전 세계)"]
    },
    "콩 (대두/팥 등)": {
        "사용량_순위": {"중국": 100, "브라질": 95, "미국": 90, "아르헨티나": 80, "인도": 75, "나이지리아": 70, "한국": 65, "일본": 60, "캐나다": 55, "파라과이": 50},
        "유명_음식": ["두부/된장 (한국)", "미소시루 (일본)", "페이장 (쿠바/브라질)"]
    },
    "고추": {
        "사용량_순위": {"인도": 100, "멕시코": 95, "태국": 90, "한국": 85, "중국": 80, "파키스탄": 75, "인도네시아": 70, "터키": 65, "페루": 60, "헝가리": 55},
        "유명_음식": ["김치/고추장 (한국)", "커리 (인도/태국)", "칠리 콘 카르네 (멕시코)"]
    },
    "치즈": {
        "사용량_순위": {"프랑스": 100, "그리스": 95, "이탈리아": 90, "독일": 85, "스위스": 80, "네덜란드": 75, "미국": 70, "덴마크": 65, "영국": 60, "아르헨티나": 55},
        "유명_음식": ["피자/라자냐 (이탈리아)", "퐁듀 (스위스/프랑스)", "타르티플레트 (프랑스)"]
    }
}

# --- 🚀 Streamlit 앱 메인 함수 ---
def main():
    st.set_page_config(page_title="재료별 국가 사용량 분석", layout="wide")
    st.title("🌎 10가지 재료별 국가 사용량 및 추천 음식 분석")
    st.markdown("---")

    # 1. 재료 선택 위젯
    ingredients = list(INGREDIENT_DATA.keys())
    
    # 템플릿 선택 및 안내
    col1, col2 = st.columns([1, 2])
    
    with col1:
        selected_ingredient = st.selectbox(
            "👇 **10가지 재료 중 하나를 선택하세요:**",
            ingredients,
            key="ingredient_select"
        )

    st.markdown("---")
    
    if selected_ingredient:
        data = INGREDIENT_DATA[selected_ingredient]

        # 2. 그래프 영역
        st.header(f"📈 '{selected_ingredient}' 사용량 순위 (상위 10개국)")
        st.caption("🚨 **주의:** 아래 '사용량 점수'는 상대적인 비교를 위해 임의로 설정된 값입니다. 절대적인 소비량이 아닙니다.")
        
        # 딕셔너리를 Pandas DataFrame으로 변환
        # 순위를 내림차순으로 정렬
        sorted_countries = sorted(data["사용량_순위"].items(), key=lambda item: item[1], reverse=True)
        df_data = {
            '나라': [item[0] for item in sorted_countries],
            '사용량 점수': [item[1] for item in sorted_countries]
        }
        df = pd.DataFrame(df_data).set_index('나라')
        
        # 그래프 출력
        st.bar_chart(df, use_container_width=True, height=400)

        st.markdown("---")

        # 3. 유명 음식 추천 영역
        st.header(f"🍽️ '{selected_ingredient}'로 만든 가장 유명한 음식 3가지")
        st.markdown(f"선택하신 **{selected_ingredient}**을(를) 활용하는 대표적인 세계 음식입니다:")
        
        # 음식 리스트 출력 (컬럼을 사용해 깔끔하게 정렬)
        food_columns = st.columns(3)
        foods = data["유명_음식"]
        
        for i, food in enumerate(foods):
            with food_columns[i]:
                st.info(f"**#{i+1}**")
                st.markdown(f"### {food}")
                
        # 마무리 효과
        if random.random() < 0.5: # 50% 확률로 풍선 효과
            st.balloons()

# 앱 실행
if __name__ == "__main__":
    main()
